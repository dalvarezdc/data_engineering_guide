# Solutions: Subject 2 (DeFi Mechanics - 1inch Context)

## 1. Slippage Calculation
**Question:** Define "Slippage." How would you calculate the *actual* slippage a user experienced on a past trade using only on-chain data?

**Answer:**
*   **Definition:** Slippage is the difference between the *expected price* of a trade (quoted at the moment of signing) and the *executed price* (actual fill).
*   **Calculation Logic:**
    1.  **Extract Expected Return:** Parse the transaction's `input data` (decoding the `swap` function call). Look for the `minReturn` or `minAmountOut` parameter. This was the user's "worst-case scenario" guarantee.
    2.  **Extract Actual Return:** Parse the `Transfer` event logs generated by the transaction. Sum the amount of "Token B" executed to the user's wallet.
    3.  **Compare:**
        *   *Slippage %* = `(Expected_Amount - Actual_Amount) / Expected_Amount`
    *   *Note:* Strictly speaking, to measure *price impact* vs. market price, you'd need the Oracle price at that block. But to measure "realized slippage" vs. "quoted," you compare the quote (from the API/Input) vs. the Log.

## 2. 1inch Fusion (Dutch Auction)
**Question:** What is a "Dutch Auction" in the context of 1inch Fusion? How does the price behavior differ from a standard Uniswap AMM pool?

**Answer:**
*   **Standard AMM (Uniswap):** Price is static at any given instant, determined purely by the ratio of tokens in the pool (`x * y = k`). It only changes if someone trades.
*   **Dutch Auction (Fusion):** Price is **dynamic based on time**.
    *   The user signs an order with a price range (e.g., "Sell 1 ETH for 2000 USDC -> 1950 USDC").
    *   The price starts *high* (in the user's favor) and linearly *decreases* over a set duration (e.g., 2 minutes).
    *   **Solvers** watch this price drop. As soon as the price hits a level where they can make a profit (by sourcing the liquidity elsewhere cheaper), they execute the fill.
    *   *Benefit:* This naturally finds the "market clearing price" without the user needing to guess the slippage or pay gas.

## 3. MEV (Maximal Extractable Value)
**Question:** Explain "MEV" to a non-technical stakeholder. Give one example of "Toxic MEV" that 1inch protects users against.

**Answer:**
*   **ELi5 Definition:** Think of the blockchain mempool as a glass waiting room for transactions. Miners (and sophisticated bots) can see your transaction *before* it gets processed. They have the power to shuffle the line order. "MEV" is the profit they make by rearranging this line.
*   **Toxic Example: Sandwich Attack.**
    *   *Scenario:* You try to buy a large amount of a token.
    *   *Attack:* A bot sees your pending buy. It bribes the miner to let it buy *right before* you (front-run).
    *   *Result:* Its buy pushes the price up. You execute your buy at this inflated price (slippage). The bot immediately sells *after* you (back-run) to lock in a risk-free profit.
    *   *1inch Protection:* Fusion orders are not sent to the public mempool; they are matched directly with professional Solvers, making Sandwich attacks impossible (since the price is fixed by the auction, not the pool state).

## 4. Router vs. Factory Contracts
**Question:** What is the difference between a "Router" contract and a "Factory" contract in a DEX ecosystem? Which one emits the `Swap` events?

**Answer:**
*   **Factory:**
    *   *Role:* The "Cookie Cutter." It deploys new smart contracts for trading pairs (e.g., creates the specific USDC/ETH pool contract). It keeps a registry of all pools it created.
    *   *Events:* Emits `PairCreated` events.
*   **Router:**
    *   *Role:* The "Traffic Controller." Users interact with *this* contract. It accepts user funds and routes them to the correct Pool contract(s). It handles the logic of multi-hop swaps (A -> B -> C).
*   **Who emits `Swap`?**
    *   The **Pool Contract** (the pair itself) emits the `Swap` event.
    *   *Data Gotcha:* If you only listen to the Router, you will miss the actual swap data. The Router *triggers* the swap, but the Pool *records* it.
